<!DOCTYPE html>
<meta charset="utf-8">
<style>

svg {
  font: 10px sans-serif;
}

.area {
  fill: black;
  clip-path: url(#clip);
}
.peak line,
.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.brush .extent {
  stroke: #fff;
  fill-opacity: .125;
  shape-rendering: crispEdges;
}

</style>

<body>
<div>
<input type="file", id="file"><br>
<button id ="parseFile"> Parse File(s)</button><br>
<canvas id="canvas"></canvas>
</div>
<script src="./js/d3.min.js"></script>
<script src="./js/jquery-2.1.0.min.js"></script>
<script src="./js/fabric.min.js"></script>
<script src="./js/jquery.parse.min.js"></script>

<script>
var width = 960,
	height = 500,
	margin = {top: 10, right: 10, bottom: 100, left: 40},
	margin2 = {top: 430, right: 10, bottom: 20, left: 40};
	//width = 960 - margin.left - margin.right,
	//height = 500 - margin.top - margin.bottom,
	//height2 = 500 - margin2.top - margin2.bottom;

function SvgObj(size) {
	// Default parameter for width and height of the canvas.
	this.y_notation = d3.format("e");
	
	this.width = width - size.left - size.right;	
	this.height = height - size.top - size.bottom;
	
	this.scale_x = d3.scale.linear().range([0, this.getWidth]);
	this.scale_y = d3.scale.linear().range([this.getHeight, 0]);

	this.xAxis = d3.svg.axis().scale(this.scale_x).orient("bottom");
	this.yAxis = d3.svg.axis().scale(this.scale_y).orient("left").tickFormat(this.y_notation);
	
	this.updateMarginalWidth = function(w) {
		this.width = w - size.left - size.right;
	}
	this.updateMarginalHeight = function(h) {
		this.height = h - size.top - size.bottom;
	}

	this.createSVG = function(data, selection, svg_class) {
		// 1. data is an object for passing the information.
		// 2. selection is for selected object in the document.
		// 3. svg_class is for the class of the svg element.  It is usually for differentiation 
		// between multiple svg elements.
		console.log("Data", data);
		console.log("Width", this.width);
		console.log("Height", this.height);
		
		// Create svg canvas
		var svg = selection.append("svg")
			.attr("class", svg_class)
			.attr("width", this.width)
			.attr("height", this.height);
			
		// Adjust the origin of the coordinates.
		svg.append("g")
			.attr("class", "framework")
			.attr("transform", "translate(" + size.left + "," + size.top + ")");
		
		// Update the domain of axis
		this.scale_x.domain([0.9 * d3.min(data.rows.map(function(d) { return d["MZ"]; })), 1.1 * d3.max(data.rows.map(function(d) { return d["MZ"]; }))]);
		this.scale_y.domain([0, 1.1 * d3.max(data.rows.map(function(d) { return d["Intensity"]; }))]);
		
		svg.append("g")
			.attr("class", "x axis")
			.attr("transform", "translate(0," + height + ")")
			.call(this.xAxis);
		
		// The group of axis y	  
		svg.append("g")
			.attr("class", "y axis")
			.call(this.yAxis);
		
	}
}

$(function() {
	
	// 1. Load data
	$('#parseFile').click( function() {
		$('input[type=file]').parse({
			config: {
				delimiter: "\t"
			},
			complete: function(data) {

				svgFramework(data.results);
				
				render(data.results);
			}
		});
	});
	
	// 2. Render the data using canvas
	function render(results) {
		var canvas = new fabric.Canvas("canvas");
	}
	
	// 3. Plot the svg framework using svg
	function svgFramework(results) {
		
		var selection = d3.select("body");
		
		var focus_svg = new SvgObj(margin);
		focus_svg.createSVG(results, selection, "focus");
		
		var context_svg = new SvgObj(margin2);
		context_svg.createSVG(results, selection, "context");
		
		/*console.log("Parse results:", results);
		var sci_notation = d3.format("e");
		
		var scale_x = d3.scale.linear().range([0, width]),
			scale_x2 = d3.scale.linear().range([0, width]),
			scale_y = d3.scale.linear().range([height, 0]),
			scale_y2 = d3.scale.linear().range([height2, 0]);

		var xAxis = d3.svg.axis().scale(scale_x).orient("bottom"),
			xAxis2 = d3.svg.axis().scale(scale_x2).orient("bottom"),
			yAxis = d3.svg.axis().scale(scale_y).orient("left").tickFormat(sci_notation);
			
		var context_svg = d3.select("body").append("svg")
			.attr("class", "context")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height2 + margin.top + margin.bottom);
			
		var focus_svg = d3.select("body").append("svg")
			.attr("class", "focus")
			.attr("width", width + margin2.left + margin2.right)
			.attr("height", height + margin2.top + margin2.bottom);

		// It constrains the region where the data can be visualized.
		// Any element beyond that is not visualized.
		context_svg.append("defs").append("clipPath")
			.attr("id", "clip")
			.append("rect")
			.attr("width", width)
			.attr("height", height);

		var focus = focus_svg.append("g")
			.attr("class", "focus")
			.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		
		var context = context_svg.append("g")
                 .attr("class", "context")
                 .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");
				 
		scale_x.domain([0.9 * d3.min(results.rows.map(function(d) { return d["MZ"]; })), 1.1 * d3.max(results.rows.map(function(d) { return d["MZ"]; }))]);
		scale_x2.domain(scale_x.domain());
		//console.log(scale_x.domain());
		scale_y.domain([0, 1.1 * d3.max(results.rows.map(function(d) { return d["Intensity"]; }))]);
		//console.log(scale_y.domain());
		
		// The group of axis x
		focus.append("g")
		.attr("class", "x axis")
		.attr("transform", "translate(0," + height + ")")
		.call(xAxis);
		
		// The group of axis y	  
		focus.append("g")
		.attr("class", "y axis")
		.call(yAxis);
		
		context.append("g")
		.attr("class", "x axis")
		.attr("transform", "translate(0," + height2 + ")")
		.call(xAxis); */
	}

});




</script>